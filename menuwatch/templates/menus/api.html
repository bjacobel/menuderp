<script>
    var opts = {
        lines: 10, // The number of lines to draw
        length: 4, // The length of each line
        width: 2, // The line thickness
        radius: 3, // The radius of the inner circle
        corners: 1, // Corner roundness (0..1)
        rotate: 0, // The rotation offset
        direction: 1, // 1: clockwise, -1: counterclockwise
        color: '#333', // #rgb or #rrggbb or array of colors
        speed: 1, // Rounds per second
        trail: 60, // Afterglow percentage
        shadow: false, // Whether to render a shadow
        hwaccel: false, // Whether to use hardware acceleration
        className: 'spinner', // The CSS class to assign to the spinner
        zIndex: 2e9, // The z-index (defaults to 2000000000)
        top: '1', // Top position relative to parent in px
        left: '-2' // Left position relative to parent in px
    };
    $(".api").click(function() {
        // drop your cocks and grab your socks
        $button = $(this);
        $icon = $('i', $(this))

        // remove the button's icon
        $icon.addClass('invisible');

        // fire up a spinner in place of the button's icon
        spinner = new Spinner(opts).spin($(this)[0]);

        // determine the API endpoint
        if ($button.hasClass("delete")) {
            apiendpoint = 'delete';
        } else if ($(this).hasClass("add")) {
            apiendpoint = 'add';
        }

        $.ajax({
            data: {"food_pk": $(this).attr("data")},
            type: 'post',
            url: '/api/'+apiendpoint,
            success: function(response) {
                spinner.stop();
                if (apiendpoint == 'delete') {
                    $icon.parent().parent().remove();
                } else if (apiendpoint == 'add') {
                    $icon.replaceWith("<i class='icon-ok green></i>");
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
                console.log(xhr, ajaxOptions, thrownError);
                
                // go back to the way things were
                spinner.stop();
                $icon.removeClass('invisible');

                // if the error was because you've run out of watches... go pay me money.
                if (xhr.status==418) {
                    window.location.href = "/upgrade";
                }
            }
        });
    });
</script>